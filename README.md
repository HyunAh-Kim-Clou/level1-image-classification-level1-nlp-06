# P stage L1 - Image Classification Project

## 📝 프로젝트 주제

- 마스크 착용 상태 분류
    - 카메라로 촬영한 사람 얼굴 이미지의 마스크 착용 여부를 판단하는 Task
    - 사람의 성별, 연령대, 마스크 착용 여부를 한꺼번에 추론하여 총 18개의 class로 판정

<br/>

## 📝 프로젝트 설명

- <b>배경</b>
    - Covid-19의 확산으로 감염 확산 방지를 위해 마스크 착용이 의무화
        - 따라서 공공 장소에 있는 사람들은 반드시 마스크를 착용해야 할 필요가 있음.
        - 또 코와 입을 완전히 가릴 수 있도록 올바르게 착용하는 것이 중요
    - 하지만 넓은 공공장소에서 모든 사람들의 올바른 마스크 착용 상태를 검사하기 위해선 추가 인적 자원이 필요
        - 따라서 사람 얼굴 이미지 만으로 이 사람이 마스크를 쓰고 있는지, 정확히 쓴 것이 맞는지 자동으로 가려낼 시스템을 만들어 내 보려고 함
- <b>목표</b>
    - CNN 모델을 활용해 Image Classification Task를 수행
- <b>평가</b>
    - f1 score (macro)

![f1_score_explain](images/f1_score.png)

<br/>

## 🔥 Final Score

|  | Public | Private |
| --- | --- | --- |
| F1 Score | 0.7264 | 0.7107 |
| Accuracy | 78.5397 | 77.6349 |

- 선정 모델: `Resnet50`
- 가중치 초기화: `Xavier`
   - [Xavier-uniform-notion-정리](https://www.notion.so/Xavier-uniform-3e4d82d0869a4a89a8e033232d45c12e)

- 모델 선정 및 분석

![ensemble_model_table](images/best_score_model.png)


- best top-5 모델의 결과에 대해 hard-voting 수행 ⇒ 최종 f1 score `0.7264 => 0.7107`   accuracy `78.5397 => 77.6349`

<br/>

### 모델 평가 및 개선

- 결과 분석
    - 나이: 노인을 제대로 판별 못하는 경우가 대부분이었음.
    - 성별: 여성이 자주 입는 복장과 그 색을 학습해버려, 그런 패턴의 옷을 입은 남성을 여성이라 판정하는 경우가 있었음
    - 마스크: Incorrect 판별에 다소 어려움이 있었음.
- 개선 방향
    - Oversampling으로 클래스간 불균형을 줄이고, 확률적 Augmentation을 도입하여 overfitting 방지 → 의도는 좋았으나, 결과가 좋지 못했음
    - Ensemble 기법 중 Hard Voting을 사용 → F1 스코어 상승

<br/>


## 🔥 자체 평가 의견

### 1) 아쉬운 점

- EDA를 면밀히 수행하여, 이를 기반으로 정확한 Metric을 정하고, 이를 논리정연하게 설득하여 팀 공통 지표로 만들지 못한 점이 아쉽다
    - 데일리 스크럼과 피어세션을 통해 데이터에 대한 각자 인사이트는 공유했지만, 거기서 끝나버린 점이 아쉬웠다. 추상적으로 각자 생각만 해두는 것이 아닌,  체계적으로 이에 대한 정리를 해두는 것이 필요했다고 느꼈다.
    - 특히 대회 Public과 유사한 환경을 조성하지 못한 점이 아쉽다. 그렇다보니 각자 결과를 평가하는 방식이 모두 달랐다. 다음 프로젝트에서는 실험 전 팀원 간 공통 Metric을 고정해야 더 정확하고 빠른 실험이 가능할 것이다.
- 댜앙한 시도를 해보지 않은 점
    - 너무 기본적인 하이퍼파라미터 튜닝과 모델링에 매몰되어 실험을 진행했다고 분석했다. 마스크, 성별, 나이를 분류해서 모델을 개발해본다던지 등 학습 플로우를 다양하게 가져갈 수 있었지만 아무래도 첫 프로젝트다 보니 실험하기 급급해 다양한 시도를 해보지 못했다고 느꼈다. 단일 모델에 대한 의존을 줄이고 새로운 시도를 해보는 것이 필요하다 느꼈다.
- 실험 관리에 대한 통일
    - 프로젝트 초반, Wandb를 사용해 실험을 정리해두자라는 말이 나왔지만 서로 베이스라인 코드를 짜고 성능을 향상하는데 집중하다 보니 실험에 대한 관리가 많이 미흡했다. 후반부로 갈수록 조금씩 설정을 해 두긴 했지만 좋은 성능을 낸 모델들이 초반부에 나온 모델들이기 때문에 시연 결과를 설명할 수 있는 그래프 등이 부족했다. 다음 프로젝트에는 초반 베이스라인부터 실험 셋팅에 대한 코드를 통일해 실험에 대한 결과를 저장하고 정리해두는게 필요할 것 같다.
- git 코드 공유 및 관리 미흡
    - 각자 베이스라인 코드를 custom하여 사용하다보니 공유하기 어려웠다. 다같이 공통적인 코드를 기반으로 프로젝트를 시작해서 개개인마다 모듈을 추가하는 방식이 필요할 것 같다.
    - PR을 대회 끝나고 처음으로 하여 PR 활용을 하지 못한 것 같아 아쉬웠다. 앞으로는 PR을 활용하여 서로의 코드 피드백을 진행해볼 것이다.

<br/>

### 2) 잘한 점

- 베이스라인 코드를 모두가 직접 다 작성해본 점
    - 협업 면에서는 아쉬웠지만, 모두가 한번씩 직접 코드를 작성해보고 오류를 해결해보았다는 점은 모두가 잘한 점이라고 동의했다. 시간은 오래 걸렸을 수도 있지만, 지금이 아니라면 이렇게 end-to-end로 코드를 작성해 볼 기회가 없었을 것이였기 때문에 이번 프로젝트에서 가장 잘한 점을 꼽자면 이 부분이라 생각한다.
- 데일리스크럼 및 피어세션에서 서로의 인사이트를 공유한 것
- 경량화된 모델로 짧은 시간 내에 실험을 다변화 시킨 것




<br/>
<br/>

## 🖼 GitHub 폴더 및 프로젝트 구조

- GitHub 폴더 구조
    - `special_mission` : 대회 기간 동안의 실험 및 작업 폴더
    - `final_submission` : 최종 작업물

- 각 프로젝트 구조
    - `dataset.py` : 입력 데이터셋과 출력 데이터셋
    - `train.py` : 모델 학습
    - `model.py` : 모델 구조
    - `loss.py` : 학습을 위한 loss 함수
    - `inference.py` : 클래스 추론
    - `sample_submission.py` : EDA 등 실험

<br/>

## 🖼 프로젝트 팀 구성 및 역할

- 김준재: 프로젝트 개발(모델 튜닝), 데이터 분할 개선, Validation Metric 개선
- 김현아: 프로젝트 개발(설계 및 실험), transform 실험, PCA 시도
- 배현진: 프로젝트 개발(데이터, 앙상블 모델 실험), 실험 추적
- 이강민: 프로젝트 개발 (모델 튜닝 및 실험, wandb 기본 셋팅)

<br/>

## 🖼 활용 장비 및 재료(개발 환경, 협업 tool 등)

- 개발 환경: Ubuntu 18.04.5 LTS
    - 장비: V100
    - IDE: VS Code, Jupyter Notebook
- 협업
    - Notion: 로그 기록 및 인사이트 공유
    - Github: 코드 관리 및 공유
    - Slack: 일정 공유
    - Zoom: 회의 및 인사이트 공유
    - WandB: 실험 결과, Metric 정보 공유
